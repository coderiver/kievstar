!function(e){e.widget("ui.selectmenu",{options:{appendTo:"body",typeAhead:1e3,style:"dropdown",positionOptions:null,width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,escapeHtml:!1,bgImage:function(){}},_create:function(){var t=this,i=this.options,s=this.element.uniqueId().attr("id");this.ids=[s,s+"-button",s+"-menu"],this._safemouseup=!0,this.isOpen=!1,this.newelement=e("<a />",{"class":"ui-selectmenu ui-widget ui-state-default ui-corner-all",id:this.ids[1],role:"button",href:"#nogo",tabindex:this.element.attr("disabled")?1:0,"aria-haspopup":!0,"aria-owns":this.ids[2]}),this.newelementWrap=e("<span />").append(this.newelement).insertAfter(this.element);var n=this.element.attr("tabindex");n&&this.newelement.attr("tabindex",n),this.newelement.data("selectelement",this.element),this.selectmenuIcon=e('<span class="ui-selectmenu-icon ui-icon"></span>').prependTo(this.newelement),this.newelement.prepend('<span class="ui-selectmenu-status" />'),this.element.bind({"click.selectmenu":function(e){t.newelement.focus(),e.preventDefault()}}),this.newelement.bind("mousedown.selectmenu",function(e){t._toggle(e,!0),"popup"==i.style&&(t._safemouseup=!1,setTimeout(function(){t._safemouseup=!0},300)),e.preventDefault()}).bind("click.selectmenu",function(e){e.preventDefault()}).bind("keydown.selectmenu",function(i){var s=!1;switch(i.keyCode){case e.ui.keyCode.ENTER:s=!0;break;case e.ui.keyCode.SPACE:t._toggle(i);break;case e.ui.keyCode.UP:i.altKey?t.open(i):t._moveSelection(-1);break;case e.ui.keyCode.DOWN:i.altKey?t.open(i):t._moveSelection(1);break;case e.ui.keyCode.LEFT:t._moveSelection(-1);break;case e.ui.keyCode.RIGHT:t._moveSelection(1);break;case e.ui.keyCode.TAB:s=!0;break;case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.HOME:t.index(0);break;case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.END:t.index(t._optionLis.length);break;default:s=!0}return s}).bind("keypress.selectmenu",function(e){return e.which>0&&t._typeAhead(e.which,"mouseup"),!0}).bind("mouseover.selectmenu",function(){i.disabled||e(this).addClass("ui-state-hover")}).bind("mouseout.selectmenu",function(){i.disabled||e(this).removeClass("ui-state-hover")}).bind("focus.selectmenu",function(){i.disabled||e(this).addClass("ui-state-focus")}).bind("blur.selectmenu",function(){i.disabled||e(this).removeClass("ui-state-focus")}),e(document).bind("mousedown.selectmenu-"+this.ids[0],function(i){t.isOpen&&!e(i.target).closest("#"+t.ids[1]).length&&t.close(i)}),this.element.bind("click.selectmenu",function(){t._refreshValue()}).bind("focus.selectmenu",function(){t.newelement&&t.newelement[0].focus()}),i.width||(i.width=this.element.outerWidth()),this.newelement.width(i.width),this.element.hide(),this.list=e("<ul />",{"class":"ui-widget ui-widget-content","aria-hidden":!0,role:"listbox","aria-labelledby":this.ids[1],id:this.ids[2]}),this.listWrap=e("<div />",{"class":"ui-selectmenu-menu"}).append(this.list).appendTo(i.appendTo),this.list.bind("keydown.selectmenu",function(i){var s=!1;switch(i.keyCode){case e.ui.keyCode.UP:i.altKey?t.close(i,!0):t._moveFocus(-1);break;case e.ui.keyCode.DOWN:i.altKey?t.close(i,!0):t._moveFocus(1);break;case e.ui.keyCode.LEFT:t._moveFocus(-1);break;case e.ui.keyCode.RIGHT:t._moveFocus(1);break;case e.ui.keyCode.HOME:t._moveFocus(":first");break;case e.ui.keyCode.PAGE_UP:t._scrollPage("up");break;case e.ui.keyCode.PAGE_DOWN:t._scrollPage("down");break;case e.ui.keyCode.END:t._moveFocus(":last");break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:t.close(i,!0),e(i.target).parents("li:eq(0)").trigger("mouseup");break;case e.ui.keyCode.TAB:s=!0,t.close(i,!0),e(i.target).parents("li:eq(0)").trigger("mouseup");break;case e.ui.keyCode.ESCAPE:t.close(i,!0);break;default:s=!0}return s}).bind("keypress.selectmenu",function(e){return e.which>0&&t._typeAhead(e.which,"focus"),!0}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return!1}),e(window).bind("resize.selectmenu-"+this.ids[0],e.proxy(t.close,this))},_init:function(){var t=this,i=this.options,s=[];this.element.find("option").each(function(){var n=e(this);s.push({value:n.attr("value"),text:t._formatText(n.text(),n),selected:n.attr("selected"),disabled:n.attr("disabled"),classes:n.attr("class"),typeahead:n.attr("typeahead"),parentOptGroup:n.parent("optgroup"),bgImage:i.bgImage.call(n)})});var n="popup"==t.options.style?" ui-state-active":"";if(this.list.html(""),s.length)for(var a=0;a<s.length;a++){var o={role:"presentation"};s[a].disabled&&(o["class"]="ui-state-disabled");var l={html:s[a].text||"&nbsp;",href:"#nogo",tabindex:-1,role:"option","aria-selected":!1};s[a].disabled&&(l["aria-disabled"]=!0),s[a].typeahead&&(l.typeahead=s[a].typeahead);var u=e("<a/>",l).bind("focus.selectmenu",function(){e(this).parent().mouseover()}).bind("blur.selectmenu",function(){e(this).parent().mouseout()}),d=e("<li/>",o).append(u).data("index",a).addClass(s[a].classes).data("optionClasses",s[a].classes||"").bind("mouseup.selectmenu",function(i){return!t._safemouseup||t._disabled(i.currentTarget)||t._disabled(e(i.currentTarget).parents("ul > li.ui-selectmenu-group "))||(t.index(e(this).data("index")),t.select(i),t.close(i,!0)),!1}).bind("click.selectmenu",function(){return!1}).bind("mouseover.selectmenu",function(i){e(this).hasClass("ui-state-disabled")||e(this).parent("ul").parent("li").hasClass("ui-state-disabled")||(i.optionValue=t.element[0].options[e(this).data("index")].value,t._trigger("hover",i,t._uiHash()),t._selectedOptionLi().addClass(n),t._focusedOptionLi().removeClass("ui-selectmenu-item-focus ui-state-hover"),e(this).removeClass("ui-state-active").addClass("ui-selectmenu-item-focus ui-state-hover"))}).bind("mouseout.selectmenu",function(i){e(this).is(t._selectedOptionLi())&&e(this).addClass(n),i.optionValue=t.element[0].options[e(this).data("index")].value,t._trigger("blur",i,t._uiHash()),e(this).removeClass("ui-selectmenu-item-focus ui-state-hover")});if(s[a].parentOptGroup.length){var r="ui-selectmenu-group-"+this.element.find("optgroup").index(s[a].parentOptGroup);this.list.find("li."+r).length?this.list.find("li."+r+":last ul").append(d):e('<li role="presentation" class="ui-selectmenu-group '+r+(s[a].parentOptGroup.attr("disabled")?' ui-state-disabled" aria-disabled="true"':'"')+'><span class="ui-selectmenu-group-label">'+s[a].parentOptGroup.attr("label")+"</span><ul></ul></li>").appendTo(this.list).find("ul").append(d)}else d.appendTo(this.list);if(i.icons)for(var h in i.icons)if(d.is(i.icons[h].find)){d.data("optionClasses",s[a].classes+" ui-selectmenu-hasIcon").addClass("ui-selectmenu-hasIcon");var c=i.icons[h].icon||"";d.find("a:eq(0)").prepend('<span class="ui-selectmenu-item-icon ui-icon '+c+'"></span>'),s[a].bgImage&&d.find("span").css("background-image",s[a].bgImage)}}else e('<li role="presentation"><a href="#nogo" tabindex="-1" role="option"></a></li>').appendTo(this.list);var p="dropdown"==i.style;this.newelement.toggleClass("ui-selectmenu-dropdown",p).toggleClass("ui-selectmenu-popup",!p),this.list.toggleClass("ui-selectmenu-menu-dropdown ui-corner-bottom",p).toggleClass("ui-selectmenu-menu-popup ui-corner-all",!p).find("li:first").toggleClass("ui-corner-top",!p).end().find("li:last").addClass("ui-corner-bottom"),this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",p).toggleClass("ui-icon-triangle-2-n-s",!p),"dropdown"==i.style?this.list.width(i.menuWidth?i.menuWidth:i.width):this.list.width(i.menuWidth?i.menuWidth:i.width-i.handleWidth),this.list.css("height","auto");var m=this.listWrap.height(),f=e(window).height(),_=i.maxHeight?Math.min(i.maxHeight,f):f/3;m>_&&this.list.height(_),this._optionLis=this.list.find("li:not(.ui-selectmenu-group)"),this.element.attr("disabled")?this.disable():this.enable(),this._refreshValue(),this._selectedOptionLi().addClass("ui-selectmenu-item-focus"),clearTimeout(this.refreshTimeout),this.refreshTimeout=window.setTimeout(function(){t._refreshPosition()},200)},destroy:function(){this.element.removeData(this.widgetName).removeClass("ui-selectmenu-disabled ui-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu"),e(window).unbind(".selectmenu-"+this.ids[0]),e(document).unbind(".selectmenu-"+this.ids[0]),this.newelementWrap.remove(),this.listWrap.remove(),this.element.unbind(".selectmenu").show(),e.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(e,t){var i=this,s=String.fromCharCode(e).toLowerCase(),n=null,a=null;i._typeAhead_timer&&(window.clearTimeout(i._typeAhead_timer),i._typeAhead_timer=void 0),i._typeAhead_chars=(void 0===i._typeAhead_chars?"":i._typeAhead_chars).concat(s),i._typeAhead_chars.length<2||i._typeAhead_chars.substr(-2,1)===s&&i._typeAhead_cycling?(i._typeAhead_cycling=!0,n=s):(i._typeAhead_cycling=!1,n=i._typeAhead_chars);for(var o=("focus"!==t?this._selectedOptionLi().data("index"):this._focusedOptionLi().data("index"))||0,l=0;l<this._optionLis.length;l++){var u=this._optionLis.eq(l).text().substr(0,n.length).toLowerCase();if(u===n)if(i._typeAhead_cycling){if(null===a&&(a=l),l>o){a=l;break}}else a=l}null!==a&&this._optionLis.eq(a).find("a").trigger(t),i._typeAhead_timer=window.setTimeout(function(){i._typeAhead_timer=void 0,i._typeAhead_chars=void 0,i._typeAhead_cycling=void 0},i.options.typeAhead)},_uiHash:function(){var t=this.index();return{index:t,option:e("option",this.element).get(t),value:this.element[0].value}},open:function(e){if("true"!=this.newelement.attr("aria-disabled")){var t=this,i=this.options,s=this._selectedOptionLi(),n=s.find("a");t._closeOthers(e),t.newelement.addClass("ui-state-active"),t.list.attr("aria-hidden",!1),t.listWrap.addClass("ui-selectmenu-open"),"dropdown"==i.style?t.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"):this.list.css("left",-5e3).scrollTop(this.list.scrollTop()+s.position().top-this.list.outerHeight()/2+s.outerHeight()/2).css("left","auto"),t._refreshPosition(),n.length&&n[0].focus(),t.isOpen=!0,t._trigger("open",e,t._uiHash())}},close:function(e,t){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.listWrap.removeClass("ui-selectmenu-open"),this.list.attr("aria-hidden",!0),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),t&&this.newelement.focus(),this.isOpen=!1,this._trigger("close",e,this._uiHash()))},change:function(e){this.element.trigger("change"),this._trigger("change",e,this._uiHash())},select:function(e){return this._disabled(e.currentTarget)?!1:(this._trigger("select",e,this._uiHash()),void 0)},widget:function(){return this.listWrap.add(this.newelementWrap)},_closeOthers:function(t){e(".ui-selectmenu.ui-state-active").not(this.newelement).each(function(){e(this).data("selectelement").selectmenu("close",t)}),e(".ui-selectmenu.ui-state-hover").trigger("mouseout")},_toggle:function(e,t){this.isOpen?this.close(e,t):this.open(e)},_formatText:function(t,i){return this.options.format?t=this.options.format(t,i):this.options.escapeHtml&&(t=e("<div />").text(t).html()),t},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find(".ui-selectmenu-item-focus")},_moveSelection:function(e,t){if(!this.options.disabled){var i=parseInt(this._selectedOptionLi().data("index")||0,10),s=i+e;if(0>s&&(s=0),s>this._optionLis.size()-1&&(s=this._optionLis.size()-1),s===t)return!1;this._optionLis.eq(s).hasClass("ui-state-disabled")?(e>0?++e:--e,this._moveSelection(e,s)):this._optionLis.eq(s).trigger("mouseover").trigger("mouseup")}},_moveFocus:function(e,t){if(isNaN(e))var i=parseInt(this._optionLis.filter(e).data("index"),10);else var s=parseInt(this._focusedOptionLi().data("index")||0,10),i=s+e;if(0>i&&(i=0),i>this._optionLis.size()-1&&(i=this._optionLis.size()-1),i===t)return!1;var n="ui-selectmenu-item-"+Math.round(1e3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id",""),this._optionLis.eq(i).hasClass("ui-state-disabled")?(e>0?++e:--e,this._moveFocus(e,i)):this._optionLis.eq(i).find("a:eq(0)").attr("id",n).focus(),this.list.attr("aria-activedescendant",n)},_scrollPage:function(e){var t=Math.floor(this.list.outerHeight()/this._optionLis.first().outerHeight());t="up"==e?-t:t,this._moveFocus(t)},_setOption:function(e,t){this.options[e]=t,"disabled"==e&&(t&&this.close(),this.element.add(this.newelement).add(this.list)[t?"addClass":"removeClass"]("ui-selectmenu-disabled ui-state-disabled").attr("aria-disabled",t).attr("tabindex",t?1:0))},disable:function(e,t){"undefined"==typeof e?this._setOption("disabled",!0):this._toggleEnabled(t||"option",e,!1)},enable:function(e,t){"undefined"==typeof e?this._setOption("disabled",!1):this._toggleEnabled(t||"option",e,!0)},_disabled:function(t){return e(t).hasClass("ui-state-disabled")},_toggleEnabled:function(e,t,i){var s=this.element.find(e).eq(t),n="optgroup"===e?this.list.find("li.ui-selectmenu-group-"+t):this._optionLis.eq(t);n&&(n.toggleClass("ui-state-disabled",!i).attr("aria-disabled",!i),i?s.removeAttr("disabled"):s.attr("disabled","disabled"))},index:function(t){return arguments.length?this._disabled(e(this._optionLis[t]))||t==this._selectedIndex()?!1:(this.element[0].selectedIndex=t,this._refreshValue(),this.change(),void 0):this._selectedIndex()},value:function(e){return arguments.length&&e!=this.element[0].value?(this.element[0].value=e,this._refreshValue(),this.change(),void 0):this.element[0].value},_refreshValue:function(){var e="popup"==this.options.style?" ui-state-active":"",t="ui-selectmenu-item-"+Math.round(1e3*Math.random());this.list.find(".ui-selectmenu-item-selected").removeClass("ui-selectmenu-item-selected"+e).find("a").attr("aria-selected","false").attr("id",""),this._selectedOptionLi().addClass("ui-selectmenu-item-selected"+e).find("a").attr("aria-selected","true").attr("id",t);var i=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",s=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(i).data("optionClasses",s).addClass(s).find(".ui-selectmenu-status").html(this._selectedOptionLi().find("a:eq(0)").html()),this.list.attr("aria-activedescendant",t)},_refreshPosition:function(){var t=this.options,i={of:this.newelement,my:"left top",at:"left bottom",collision:"flip"};if("popup"==t.style){var s=this._selectedOptionLi();i.my="left top"+(this.list.offset().top-s.offset().top-(this.newelement.outerHeight()+s.outerHeight())/2),i.collision="fit"}this.listWrap.removeAttr("style").zIndex(this.element.zIndex()+2).position(e.extend(i,t.positionOptions))}})}(jQuery);