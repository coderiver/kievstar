!function(e){e.widget("ui.selectmenu",{options:{appendTo:"body",typeAhead:1e3,style:"dropdown",positionOptions:{my:"left top",at:"left bottom",offset:null},width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,escapeHtml:!1,bgImage:function(){}},_create:function(){var t=this,s=this.options,i=(this.element.attr("id")||"ui-selectmenu-"+Math.random().toString(16).slice(2,10)).replace(/(:|\.)/g,"");this.ids=[i,i+"-button",i+"-menu"],this._safemouseup=!0,this.isOpen=!1,this.newelement=e("<a />",{"class":this.widgetBaseClass+" ui-widget ui-state-default ui-corner-all",id:this.ids[1],role:"button",href:"#nogo",tabindex:this.element.attr("disabled")?1:0,"aria-haspopup":!0,"aria-owns":this.ids[2]}),this.newelementWrap=e("<span />").append(this.newelement).insertAfter(this.element);var a=this.element.attr("tabindex");a&&this.newelement.attr("tabindex",a),this.newelement.data("selectelement",this.element),this.selectmenuIcon=e('<span class="'+this.widgetBaseClass+'-icon ui-icon"></span>').prependTo(this.newelement),this.newelement.prepend('<span class="'+t.widgetBaseClass+'-status" />'),this.element.bind({"click.selectmenu":function(e){t.newelement.focus(),e.preventDefault()}}),this.newelement.bind("mousedown.selectmenu",function(e){return t._toggle(e,!0),"popup"==s.style&&(t._safemouseup=!1,setTimeout(function(){t._safemouseup=!0},300)),!1}).bind("click.selectmenu",function(){return!1}).bind("keydown.selectmenu",function(s){var i=!1;switch(s.keyCode){case e.ui.keyCode.ENTER:i=!0;break;case e.ui.keyCode.SPACE:t._toggle(s);break;case e.ui.keyCode.UP:s.altKey?t.open(s):t._moveSelection(-1);break;case e.ui.keyCode.DOWN:s.altKey?t.open(s):t._moveSelection(1);break;case e.ui.keyCode.LEFT:t._moveSelection(-1);break;case e.ui.keyCode.RIGHT:t._moveSelection(1);break;case e.ui.keyCode.TAB:i=!0;break;case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.HOME:t.index(0);break;case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.END:t.index(t._optionLis.length);break;default:i=!0}return i}).bind("keypress.selectmenu",function(e){return e.which>0&&t._typeAhead(e.which,"mouseup"),!0}).bind("mouseover.selectmenu",function(){s.disabled||e(this).addClass("ui-state-hover")}).bind("mouseout.selectmenu",function(){s.disabled||e(this).removeClass("ui-state-hover")}).bind("focus.selectmenu",function(){s.disabled||e(this).addClass("ui-state-focus")}).bind("blur.selectmenu",function(){s.disabled||e(this).removeClass("ui-state-focus")}),e(document).bind("mousedown.selectmenu-"+this.ids[0],function(e){t.isOpen&&t.close(e)}),this.element.bind("click.selectmenu",function(){t._refreshValue()}).bind("focus.selectmenu",function(){t.newelement&&t.newelement[0].focus()}),s.width||(s.width=this.element.outerWidth()),this.newelement.width(s.width),this.element.hide(),this.list=e("<ul />",{"class":"ui-widget ui-widget-content","aria-hidden":!0,role:"listbox","aria-labelledby":this.ids[1],id:this.ids[2]}),this.listWrap=e("<div />",{"class":t.widgetBaseClass+"-menu"}).append(this.list).appendTo(s.appendTo),this.list.bind("keydown.selectmenu",function(s){var i=!1;switch(s.keyCode){case e.ui.keyCode.UP:s.altKey?t.close(s,!0):t._moveFocus(-1);break;case e.ui.keyCode.DOWN:s.altKey?t.close(s,!0):t._moveFocus(1);break;case e.ui.keyCode.LEFT:t._moveFocus(-1);break;case e.ui.keyCode.RIGHT:t._moveFocus(1);break;case e.ui.keyCode.HOME:t._moveFocus(":first");break;case e.ui.keyCode.PAGE_UP:t._scrollPage("up");break;case e.ui.keyCode.PAGE_DOWN:t._scrollPage("down");break;case e.ui.keyCode.END:t._moveFocus(":last");break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:t.close(s,!0),e(s.target).parents("li:eq(0)").trigger("mouseup");break;case e.ui.keyCode.TAB:i=!0,t.close(s,!0),e(s.target).parents("li:eq(0)").trigger("mouseup");break;case e.ui.keyCode.ESCAPE:t.close(s,!0);break;default:i=!0}return i}).bind("keypress.selectmenu",function(e){return e.which>0&&t._typeAhead(e.which,"focus"),!0}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return!1}),e(window).bind("resize.selectmenu-"+this.ids[0],e.proxy(t.close,this))},_init:function(){var t=this,s=this.options,i=[];this.element.find("option").each(function(){var a=e(this);i.push({value:a.attr("value"),text:t._formatText(a.text(),a),selected:a.attr("selected"),disabled:a.attr("disabled"),classes:a.attr("class"),typeahead:a.attr("typeahead"),parentOptGroup:a.parent("optgroup"),bgImage:s.bgImage.call(a)})});var a="popup"==t.options.style?" ui-state-active":"";if(this.list.html(""),i.length)for(var n=0;n<i.length;n++){var o={role:"presentation"};i[n].disabled&&(o["class"]=this.namespace+"-state-disabled");var l={html:i[n].text||"&nbsp;",href:"#nogo",tabindex:-1,role:"option","aria-selected":!1};i[n].disabled&&(l["aria-disabled"]=i[n].disabled),i[n].typeahead&&(l.typeahead=i[n].typeahead);var d=e("<a/>",l).bind("focus.selectmenu",function(){e(this).parent().mouseover()}).bind("blur.selectmenu",function(){e(this).parent().mouseout()}),r=e("<li/>",o).append(d).data("index",n).addClass(i[n].classes).data("optionClasses",i[n].classes||"").bind("mouseup.selectmenu",function(s){return!t._safemouseup||t._disabled(s.currentTarget)||t._disabled(e(s.currentTarget).parents("ul>li."+t.widgetBaseClass+"-group "))||(t.index(e(this).data("index")),t.select(s),t.close(s,!0)),!1}).bind("click.selectmenu",function(){return!1}).bind("mouseover.selectmenu",function(){e(this).hasClass(t.namespace+"-state-disabled")||e(this).parent("ul").parent("li").hasClass(t.namespace+"-state-disabled")||(t._selectedOptionLi().addClass(a),t._focusedOptionLi().removeClass(t.widgetBaseClass+"-item-focus ui-state-hover"),e(this).removeClass("ui-state-active").addClass(t.widgetBaseClass+"-item-focus ui-state-hover"))}).bind("mouseout.selectmenu",function(){e(this).is(t._selectedOptionLi())&&e(this).addClass(a),e(this).removeClass(t.widgetBaseClass+"-item-focus ui-state-hover")});if(i[n].parentOptGroup.length){var h=t.widgetBaseClass+"-group-"+this.element.find("optgroup").index(i[n].parentOptGroup);this.list.find("li."+h).length?this.list.find("li."+h+":last ul").append(r):e(' <li role="presentation" class="'+t.widgetBaseClass+"-group "+h+(i[n].parentOptGroup.attr("disabled")?" "+this.namespace+'-state-disabled" aria-disabled="true"':'"')+'><span class="'+t.widgetBaseClass+'-group-label">'+i[n].parentOptGroup.attr("label")+"</span><ul></ul></li> ").appendTo(this.list).find("ul").append(r)}else r.appendTo(this.list);if(s.icons)for(var u in s.icons)if(r.is(s.icons[u].find)){r.data("optionClasses",i[n].classes+" "+t.widgetBaseClass+"-hasIcon").addClass(t.widgetBaseClass+"-hasIcon");var c=s.icons[u].icon||"";r.find("a:eq(0)").prepend('<span class="'+t.widgetBaseClass+"-item-icon ui-icon "+c+'"></span>'),i[n].bgImage&&r.find("span").css("background-image",i[n].bgImage)}}else e('<li role="presentation"><a href="#nogo" tabindex="-1" role="option"></a></li>').appendTo(this.list);var p="dropdown"==s.style;this.newelement.toggleClass(t.widgetBaseClass+"-dropdown",p).toggleClass(t.widgetBaseClass+"-popup",!p),this.list.toggleClass(t.widgetBaseClass+"-menu-dropdown ui-corner-bottom",p).toggleClass(t.widgetBaseClass+"-menu-popup ui-corner-all",!p).find("li:first").toggleClass("ui-corner-top",!p).end().find("li:last").addClass("ui-corner-bottom"),this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",p).toggleClass("ui-icon-triangle-2-n-s",!p),"dropdown"==s.style?this.list.width(s.menuWidth?s.menuWidth:s.width):this.list.width(s.menuWidth?s.menuWidth:s.width-s.handleWidth),this.list.css("height","auto");var m=this.listWrap.height(),f=e(window).height(),g=s.maxHeight?Math.min(s.maxHeight,f):f/3;m>g&&this.list.height(g),this._optionLis=this.list.find("li:not(."+t.widgetBaseClass+"-group)"),this.element.attr("disabled")?this.disable():this.enable(),this._refreshValue(),this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-focus"),clearTimeout(this.refreshTimeout),this.refreshTimeout=window.setTimeout(function(){t._refreshPosition()},200)},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu"),e(window).unbind(".selectmenu-"+this.ids[0]),e(document).unbind(".selectmenu-"+this.ids[0]),this.newelementWrap.remove(),this.listWrap.remove(),this.element.unbind(".selectmenu").show(),e.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(e,t){var s=this,i=String.fromCharCode(e).toLowerCase(),a=null,n=null;s._typeAhead_timer&&(window.clearTimeout(s._typeAhead_timer),s._typeAhead_timer=void 0),s._typeAhead_chars=(void 0===s._typeAhead_chars?"":s._typeAhead_chars).concat(i),s._typeAhead_chars.length<2||s._typeAhead_chars.substr(-2,1)===i&&s._typeAhead_cycling?(s._typeAhead_cycling=!0,a=i):(s._typeAhead_cycling=!1,a=s._typeAhead_chars);for(var o=("focus"!==t?this._selectedOptionLi().data("index"):this._focusedOptionLi().data("index"))||0,l=0;l<this._optionLis.length;l++){var d=this._optionLis.eq(l).text().substr(0,a.length).toLowerCase();if(d===a)if(s._typeAhead_cycling){if(null===n&&(n=l),l>o){n=l;break}}else n=l}null!==n&&this._optionLis.eq(n).find("a").trigger(t),s._typeAhead_timer=window.setTimeout(function(){s._typeAhead_timer=void 0,s._typeAhead_chars=void 0,s._typeAhead_cycling=void 0},s.options.typeAhead)},_uiHash:function(){var t=this.index();return{index:t,option:e("option",this.element).get(t),value:this.element[0].value}},open:function(e){var t=this,s=this.options;if("true"!=t.newelement.attr("aria-disabled")){t._closeOthers(e),t.newelement.addClass("ui-state-active"),t.list.attr("aria-hidden",!1),t.listWrap.addClass(t.widgetBaseClass+"-open");var i=this._selectedOptionLi();"dropdown"==s.style?t.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"):this.list.css("left",-5e3).scrollTop(this.list.scrollTop()+i.position().top-this.list.outerHeight()/2+i.outerHeight()/2).css("left","auto"),t._refreshPosition();var a=i.find("a");a.length&&a[0].focus(),t.isOpen=!0,t._trigger("open",e,t._uiHash())}},close:function(e,t){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.listWrap.removeClass(this.widgetBaseClass+"-open"),this.list.attr("aria-hidden",!0),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),t&&this.newelement.focus(),this.isOpen=!1,this._trigger("close",e,this._uiHash()))},change:function(e){this.element.trigger("change"),this._trigger("change",e,this._uiHash())},select:function(e){return this._disabled(e.currentTarget)?!1:(this._trigger("select",e,this._uiHash()),void 0)},widget:function(){return this.listWrap.add(this.newelementWrap)},_closeOthers:function(t){e("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){e(this).data("selectelement").selectmenu("close",t)}),e("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},_toggle:function(e,t){this.isOpen?this.close(e,t):this.open(e)},_formatText:function(t,s){return this.options.format?t=this.options.format(t,s):this.options.escapeHtml&&(t=e("<div />").text(t).html()),t},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},_moveSelection:function(e,t){if(!this.options.disabled){var s=parseInt(this._selectedOptionLi().data("index")||0,10),i=s+e;if(0>i&&(i=0),i>this._optionLis.size()-1&&(i=this._optionLis.size()-1),i===t)return!1;this._optionLis.eq(i).hasClass(this.namespace+"-state-disabled")?(e>0?++e:--e,this._moveSelection(e,i)):this._optionLis.eq(i).trigger("mouseover").trigger("mouseup")}},_moveFocus:function(e,t){if(isNaN(e))var s=parseInt(this._optionLis.filter(e).data("index"),10);else var i=parseInt(this._focusedOptionLi().data("index")||0,10),s=i+e;if(0>s&&(s=0),s>this._optionLis.size()-1&&(s=this._optionLis.size()-1),s===t)return!1;var a=this.widgetBaseClass+"-item-"+Math.round(1e3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id",""),this._optionLis.eq(s).hasClass(this.namespace+"-state-disabled")?(e>0?++e:--e,this._moveFocus(e,s)):this._optionLis.eq(s).find("a:eq(0)").attr("id",a).focus(),this.list.attr("aria-activedescendant",a)},_scrollPage:function(e){var t=Math.floor(this.list.outerHeight()/this._optionLis.first().outerHeight());t="up"==e?-t:t,this._moveFocus(t)},_setOption:function(e,t){this.options[e]=t,"disabled"==e&&(t&&this.close(),this.element.add(this.newelement).add(this.list)[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",t))},disable:function(e,t){"undefined"==typeof e?this._setOption("disabled",!0):"optgroup"==t?this._disableOptgroup(e):this._disableOption(e)},enable:function(e,t){"undefined"==typeof e?this._setOption("disabled",!1):"optgroup"==t?this._enableOptgroup(e):this._enableOption(e)},_disabled:function(t){return e(t).hasClass(this.namespace+"-state-disabled")},_disableOption:function(e){var t=this._optionLis.eq(e);t&&(t.addClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!0),this.element.find("option").eq(e).attr("disabled","disabled"))},_enableOption:function(e){var t=this._optionLis.eq(e);t&&(t.removeClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!1),this.element.find("option").eq(e).removeAttr("disabled"))},_disableOptgroup:function(e){var t=this.list.find("li."+this.widgetBaseClass+"-group-"+e);t&&(t.addClass(this.namespace+"-state-disabled").attr("aria-disabled",!0),this.element.find("optgroup").eq(e).attr("disabled","disabled"))},_enableOptgroup:function(e){var t=this.list.find("li."+this.widgetBaseClass+"-group-"+e);t&&(t.removeClass(this.namespace+"-state-disabled").attr("aria-disabled",!1),this.element.find("optgroup").eq(e).removeAttr("disabled"))},index:function(t){return arguments.length?this._disabled(e(this._optionLis[t]))||t==this._selectedIndex()?!1:(this.element[0].selectedIndex=t,this._refreshValue(),this.change(),void 0):this._selectedIndex()},value:function(e){return arguments.length&&e!=this.element[0].value?(this.element[0].value=e,this._refreshValue(),this.change(),void 0):this.element[0].value},_refreshValue:function(){var e="popup"==this.options.style?" ui-state-active":"",t=this.widgetBaseClass+"-item-"+Math.round(1e3*Math.random());this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+e).find("a").attr("aria-selected","false").attr("id",""),this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+e).find("a").attr("aria-selected","true").attr("id",t);var s=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",i=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(s).data("optionClasses",i).addClass(i).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html()),this.list.attr("aria-activedescendant",t)},_refreshPosition:function(){var e=this.options;if("popup"==e.style&&!e.positionOptions.offset)var t=this._selectedOptionLi(),s="0 "+(this.list.offset().top-t.offset().top-(this.newelement.outerHeight()+t.outerHeight())/2);this.listWrap.removeAttr("style").zIndex(this.element.zIndex()+1).position({of:e.positionOptions.of||this.newelement,my:e.positionOptions.my,at:e.positionOptions.at,offset:e.positionOptions.offset||s,collision:e.positionOptions.collision||("popup"==e.style?"fit":"flip")})}})}(jQuery);